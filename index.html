<!DOCTYPE html>
<html>
	<head>
		<title>DRTrial - Concept test</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<style type="text/css">
body {
	margin: 0;
	padding: 0;
	background-color: #000;
	overflow: hidden;
}
canvas {
	display: block;
	margin: 0 auto;
}
#boton {
	position: absolute;
	top: 10px;
	left: 10px;
	z-index: 60;
}
#hud {
	position: absolute;
	z-index: 10;
	top: 0;
	left: 0;
	right: 0;
}
		</style>

		<script src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r69/three.min.js"></script>
		<script src="/lib/Promise.min.js"></script>

		<script src="/js/dr.audiomixer.js"></script>
		<script src="/js/dr.characters.js"></script>
		<script src="/js/dr.hud.js"></script>
		<script src="/js/dr.trial.escenario.js"></script>
		<script src="/js/dr.trial.animaciones.js"></script>
		<script src="/js/dr.trial.nsd.js"></script>
		<script src="/js/dr.scripttest.js"></script>
		<script type="application/javascript">
Promise.DOMContentLoaded([
	DR.Audio.loadBuffer('bg.mp3', 'juicio')
]).then(function(promesas) {
	var sonido = promesas[0];

	var width = window.innerWidth,
		height = Math.floor(9 / 16 * width);

	if (height > window.innerHeight) {
		height = window.innerHeight;
		width = Math.floor(16 / 9 * height);
	}

	DR.Escenario.inicializar(width, height);
	DR.hud.generate(width, height);
	DR.Escenario.construir(DR.escena);
	document.body.appendChild(DR.renderer.domElement);
	document.body.appendChild(DR.hud.canvas);

	function stop() {
		toggle = false;
		sonido.stop();
		cancelAnimationFrame(Animacion.cuadro);
		document.getElementById('boton').textContent = 'Reiniciar';

		new Animacion().tutorial();
		DR.hud.trialDiscussion();
		DR.hud.narrator('This is a very early preview test for the DRTrial project. Press the button in the corner to start.');
	}

	var toggle = false;
	document.getElementById('boton').addEventListener('click', function() {
		toggle = !toggle;
		if (toggle) {
			sonido.play(0);
			this.textContent = 'Detener';
			new Animacion()
				.tutorialToNSD()
				.iniciarNSD([
					'Tsumiki’s Examination Results',
					'Nidai’s Testimony',
					'Mioda’s Testimony',
					'Nanami’s Testimony',
					'Souda’s Testimony'
				])
				.loadScript(discusion)
				.delay(2000).promise
				.then(stop, function(e) {
					stop();
					console.error(e.stack);
				});
		} else {
			stop();
		}
	}, false);

	new Animacion().tutorial();
	DR.hud.trialDiscussion();
	DR.hud.narrator('This is a very early preview test for the DRTrial project. Press the button in the corner to start.');
});
		</script>
	</head>
	<body>
		<button id="boton">Iniciar</button>
	</body>

</html>